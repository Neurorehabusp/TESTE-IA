<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Oficina de Idea√ß√£o com Integra√ß√£o de Intelig√™ncia Artificial</title>

  <!-- Inclus√£o da biblioteca jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root { --azul-escuro:#003366; --azul-claro:#e6f0fa; }

    body{
      font-family: Arial, sans-serif;
      margin:0; padding:20px;
      background-color:#f3f3f3;
    }

    h1{ text-align:center; color:var(--azul-escuro); }

    .fase{
      background:#fff; border-radius:10px; padding:15px;
      margin:10px 0; box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }

    .fase h2{ color:var(--azul-escuro); }
    .fase p, .fase li{ white-space:pre-wrap; }
    .fase ul{ margin-left:20px; }

    .chat{
      background:#fff; border-radius:10px; padding:20px;
      margin:20px 0; box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }

    .chat input{
      flex:1; padding:10px;
      border-radius:5px; border:1px solid #ccc;
    }

    .chat button.enviar{
      margin-left:10px; padding:10px 20px;
      border-radius:5px; border:none;
      background:var(--azul-escuro); color:#fff; cursor:pointer;
    }

    .chat .mensagens{
      margin-top:15px; max-height:200px; overflow-y:auto;
      background:var(--azul-claro); padding:10px; border-radius:5px;
      font-size:14px; white-space:pre-wrap;
    }

    footer{
      font-size:0.9em; color:#555; text-align:center;
      padding:10px 0; border-top:1px solid #ccc; margin-top:20px;
    }

    footer a{ color:var(--azul-escuro); text-decoration:none; }

    button{
      padding:8px 12px; border-radius:5px; border:none;
      color:#fff; cursor:pointer;
    }

    #salvarSessao{ background-color:#2c3e50; }
    #carregarSessao{ background-color:#3498db; margin-left:10px; }
    #btnPdf{ background-color:#e67e22; }

    .title{
      text-align:center; max-width:700px; margin:0 auto;
      line-height:1.6; color:#2580c0; font-size:1.8rem;
    }
    .title h2{ margin-bottom:0.4em; font-size:2.8rem; }

    .chat-ia{ margin-top:10px; }
    .ia-row{ display:flex; align-items:center; gap:10px; }
    .ia-row input{ flex:1; }
    .fontes{ margin-top:10px; background:var(--azul-claro); padding:10px; border-radius:6px; }
    .fontes summary{ cursor:pointer; }
    .fonte-item{ margin:8px 0; padding:8px; background:#fff; border-radius:6px; border:1px solid #dbe7f5; }
    .fonte-item small{ color:#555; display:block; margin-top:4px; }
    .msg{ margin:6px 0; padding:8px; border-radius:6px; }
    .msg.user{ background:#fff; border:1px solid #ddd; }
    .msg.ai{ background:#dfefff; border:1px solid #bcd6f5; }
  </style>
</head>

<body>

  <div class="title">
    <h2>OFICINA DE IDEA√á√ÉO</h2>
  </div>

  <div class="fase">
    <div style="text-align:center; max-width:700px; margin:0 auto; line-height:1.6; color:#333;">
      <h2 style="margin-bottom:0.4em;">Sobre o Projeto</h2>
      <p style="font-size:1.1em; margin-bottom:1em;">
        Este √© um web app interativo que apresenta as etapas do Design Thinking (Oficina de Idea√ß√£o),
        com o apoio de uma Intelig√™ncia Artificial para estimular a gera√ß√£o de ideias criativas e inclusivas.
        A ideia foi desenvolvida com o foco de ser aplicada em capacita√ß√µes para professores de escola p√∫blica,
        a fim de criar solu√ß√µes inovadoras que contribuem para a inclus√£o escolar de alunos com defici√™ncia.
      </p>

      <h2 style="margin-bottom:0.4em;">Como Funciona?</h2>
      <p style="font-size:1.1em; margin-bottom:1em;">
        Abaixo est√£o apresentadas as fases da Oficina de Idea√ß√£o, com exemplos que podem ser utilizados para orientar sua proposta.
        No canto da tela, h√° um bot√£o que abre um <strong>chat com intelig√™ncia artificial</strong>: voc√™ pode inserir seu caso ou desafio
        e receber sugest√µes para desenvolver melhor sua ideia.
        Logo abaixo, h√° um campo de mensagem onde voc√™ pode registrar suas ideias. Ap√≥s preench√™-lo, clique no bot√£o <strong>‚ÄúEnviar‚Äù</strong> para salvar.
        Se quiser gerar um arquivo com o conte√∫do produzido, clique no bot√£o <strong>‚ÄúGerar PDF‚Äù</strong>.
      </p>
    </div>
  </div>

  <div class="fase">
    <h2>1. Cria√ß√£o da Persona</h2>
    <ul>
      <li>Persona: personagem fict√≠cio baseado em dados reais que representa o usu√°rio.</li>
      <li>Inclui informa√ß√µes como idade, necessidades, interesses e motiva√ß√µes.</li>
      <br />
      <strong>Exemplo: Ana, 6 anos, est√° no espectro autista, √© minimamente verbal e gosta de hist√≥rias com ilustra√ß√µes. Tem dificuldade para interagir em atividades em grupo sem apoio visual estruturado.</strong>
    </ul>
  </div>

  <div class="fase">
    <h2>2. Motivadores</h2>
    <ul>
      <li>Identifica√ß√£o do que motiva a persona: sonhos, prefer√™ncias, frustra√ß√µes.</li>
      <li>Esses dados ajudam a criar solu√ß√µes alinhadas ao que faz sentido para o usu√°rio.</li>
      <br />
      <strong>Exemplo: Ana adora contar hist√≥rias com imagens e se frustra quando n√£o consegue expressar o que sente na sala de aula.</strong>
    </ul>
  </div>

  <div class="fase">
    <h2>3. Problemas</h2>
    <ul>
      <li>Identifica√ß√£o clara da barreira enfrentada pela persona.</li>
      <li>Definir o problema de forma objetiva ajuda a equipe a trabalhar alinhada.</li>
      <br />
      <strong>Exemplo: Ana n√£o consegue se comunicar com colegas e professores por falta de recursos visuais acess√≠veis.</strong>
    </ul>
  </div>

  <div class="fase">
    <h2>4. Desenvolvimento do Projeto</h2>
    <ul>
      <li>Idea√ß√£o coletiva: gera√ß√£o de solu√ß√µes em grupo (brainstorming).</li>
      <li>Prototipagem: cria√ß√£o de modelos simples (prot√≥tipos).</li>
      <li>Teste com usu√°rios reais e coleta de feedback.</li>
      <li>Itera√ß√£o: refinar solu√ß√µes com base nas respostas dos usu√°rios.</li>
    </ul>
  </div>

  <div class="fase">
    <h2>5. Vis√£o</h2>
    <ul>
      <li>Proje√ß√£o de um futuro ideal ap√≥s a solu√ß√£o do problema.</li>
      <li>A vis√£o do futuro guia o processo criativo com um objetivo claro.</li>
      <br />
      <strong>Exemplo: Ana utilizando um aplicativo com figuras e sons para se comunicar e participar das atividades em sala.</strong>
    </ul>
  </div>

  <div class="fase">
    <h2>6. Solu√ß√£o e Impacto</h2>
    <ul>
      <li>Defini√ß√£o e valida√ß√£o da solu√ß√£o final.</li>
      <li>An√°lise do impacto: melhoria na participa√ß√£o, aprendizagem ou inclus√£o.</li>
      <li>Encerramento do ciclo com foco em resultados reais para os usu√°rios.</li>
      <br />
      <strong>Exemplo: Aplicativo de comunica√ß√£o aumentativa validado com crian√ßas autistas na escola.</strong>
    </ul>
  </div>

  <div class="chat chat-ia" aria-label="Chat com Intelig√™ncia Artificial">
    <h2>Chat IA (RAG) ü§ñüìö</h2>
    <p>Fa√ßa uma pergunta. A resposta ser√° gerada com base nos seus documentos e exibir√° as fontes consultadas.</p>

    <div class="ia-row">
      <input type="text" id="inputIa" placeholder="Ex.: Como adaptar uma atividade para promover autonomia?" />
      <button class="enviar" id="btnPerguntarIa" type="button" onclick="perguntarIa()">Perguntar</button>
    </div>

    <div class="mensagens" id="mensagensIa" aria-live="polite"></div>

    <details class="fontes" id="fontesBox" style="display:none;">
      <summary><strong>Fontes consultadas</strong></summary>
      <div id="fontesIa"></div>
    </details>
  </div>

  <div class="chat">
    <h2>Chat de Ideias üí°</h2>
    <p>Digite suas ideias e coment√°rios para salvar e depois gerar um PDF:</p>

    <div style="display:flex; align-items:center;">
      <input type="text" id="inputChat" placeholder="Digite sua ideia aqui..." />
      <button class="enviar" type="button" onclick="enviarMensagem()">Enviar</button>
    </div>

    <div class="mensagens" id="mensagens"></div>
    <button id="btnPdf" type="button" onclick="gerarPDF()">üìÑ Gerar PDF</button>
  </div>

  <div style="margin-top:10px;">
    <button id="salvarSessao" type="button" onclick="salvarSessao()">üíæ Salvar Sess√£o</button>
    <button id="carregarSessao" type="button" onclick="carregarSessao()">üìÇ Carregar Sess√£o</button>
  </div>

  <footer>
    ¬© 2025 Prof¬™ Dr¬™ Fabiana Faleiros Castro / EERP-USP<br />
    Este aplicativo est√° licenciado sob a
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.pt" target="_blank" rel="noopener noreferrer">
      Creative Commons Atribui√ß√£o-N√£oComercial-CompartilhaIgual 4.0 Internacional (CC BY-NC-SA 4.0)
    </a>.<br />
    Uso livre para fins educacionais n√£o comerciais.<br />
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
      <img src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="Licen√ßa Creative Commons" style="border-width:0; margin-top:5px;">
    </a>
  </footer>
<script>
  // ====== Config ======
const WORKER_CHAT_URL = "https://incluicanva.yasminsthtavares.workers.dev/chat";

  // ====== Chat de ideias + PDF ======
  const mensagensKey = 'chatDesignThinkingMensagens';
  const sessaoKey = 'chatDesignThinkingSessaoCompleta';
  let editandoIndex = null;

  function carregarMensagens() {
    const divMensagens = document.getElementById('mensagens');
    const msgs = JSON.parse(localStorage.getItem(mensagensKey)) || [];
    divMensagens.innerHTML = msgs.map((msg, index) => `
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
        <span>‚Ä¢ ${escapeHtml(msg)}</span>
        <div>
          <button type="button" onclick="editarMensagem(${index})" style="background:none; border:none; color:orange; font-size:16px; cursor:pointer;">‚úèÔ∏è</button>
          <button type="button" onclick="removerMensagem(${index})" style="background:none; border:none; color:red; font-size:16px; cursor:pointer;">üóëÔ∏è</button>
        </div>
      </div>
    `).join('');
    divMensagens.scrollTop = divMensagens.scrollHeight;
  }

  function removerMensagem(index) {
    const msgs = JSON.parse(localStorage.getItem(mensagensKey)) || [];
    msgs.splice(index, 1);
    localStorage.setItem(mensagensKey, JSON.stringify(msgs));
    carregarMensagens();
  }

  function editarMensagem(index) {
    const msgs = JSON.parse(localStorage.getItem(mensagensKey)) || [];
    const input = document.getElementById('inputChat');
    input.value = msgs[index];
    editandoIndex = index;
    input.focus();
  }

  function enviarMensagem() {
    const input = document.getElementById('inputChat');
    const texto = input.value.trim();
    if (!texto) return alert('Digite uma ideia antes de enviar!');
    const msgs = JSON.parse(localStorage.getItem(mensagensKey)) || [];

    if (editandoIndex !== null) {
      msgs[editandoIndex] = texto;
      editandoIndex = null;
    } else {
      msgs.push(texto);
    }

    localStorage.setItem(mensagensKey, JSON.stringify(msgs));
    input.value = '';
    carregarMensagens();
  }

  function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const msgs = JSON.parse(localStorage.getItem(mensagensKey)) || [];
    if (msgs.length === 0) return alert('N√£o h√° ideias para gerar PDF.');

    doc.setFontSize(18);
    doc.text('Ideias do Chat - Design Thinking', 10, 20);
    doc.setFontSize(12);

    let y = 40;
    msgs.forEach((msg, i) => {
      const texto = `${i + 1}. ${msg}`;
      const splitText = doc.splitTextToSize(texto, 180);
      doc.text(splitText, 10, y);
      y += splitText.length * 10;
      if (y > 280) { doc.addPage(); y = 20; }
    });

    doc.save('ideias_design_thinking.pdf');
  }

  function salvarSessao() {
    const msgs = JSON.parse(localStorage.getItem(mensagensKey)) || [];
    const input = document.getElementById('inputChat').value;
    const sessao = { mensagens: msgs, inputAtual: input, editandoIndex };
    localStorage.setItem(sessaoKey, JSON.stringify(sessao));
    alert('Sess√£o salva com sucesso!');
  }

  function carregarSessao() {
    const sessao = JSON.parse(localStorage.getItem(sessaoKey));
    if (!sessao) return alert('Nenhuma sess√£o salva encontrada.');
    localStorage.setItem(mensagensKey, JSON.stringify(sessao.mensagens));
    document.getElementById('inputChat').value = sessao.inputAtual || '';
    editandoIndex = (sessao.editandoIndex !== undefined) ? sessao.editandoIndex : null;
    carregarMensagens();
    alert('Sess√£o carregada!');
  }

  // ====== Util ======
  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // ====== Chat IA (Literatura cient√≠fica via Worker) ======
  async function perguntarIa() {
    const input = document.getElementById("inputIa");
    const mensagens = document.getElementById("mensagensIa");
    const fontesBox = document.getElementById("fontesBox");
    const fontesDiv = document.getElementById("fontesIa");

    const q = (input.value || "").trim();
    if (!q) return alert("Digite uma pergunta.");

    mensagens.innerHTML += `<div class="msg user"><strong>Voc√™:</strong> ${escapeHtml(q)}</div>`;
    mensagens.scrollTop = mensagens.scrollHeight;

    const loadingId = "loading-" + Date.now();
    mensagens.innerHTML += `<div class="msg ai" id="${loadingId}"><strong>IA:</strong> pesquisando na literatura...</div>`;
    mensagens.scrollTop = mensagens.scrollHeight;

    fontesBox.style.display = "none";
    fontesDiv.innerHTML = "";

    try {
      const resp = await fetch(WORKER_CHAT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: q })
      });

      if (!resp.ok) {
  const txt = await resp.text();
  throw new Error(`HTTP ${resp.status} - ${txt}`);
}


      if (!resp.ok) throw new Error("HTTP " + resp.status);
      const data = await resp.json();

      document.getElementById(loadingId).innerHTML =
        `<strong>IA:</strong><br>${escapeHtml(data.answer || "").replace(/\n/g, "<br>")}`;

      // Refer√™ncias (refs) retornadas pelo Worker
      if (data.refs && Array.isArray(data.refs) && data.refs.length) {
        fontesDiv.innerHTML = data.refs.map(r => `
          <div class="fonte-item">
            <strong>${escapeHtml(r.ref || "REF")}</strong>
            <small><strong>${escapeHtml(r.title || "Sem t√≠tulo")}</strong>${r.year ? ` ‚Ä¢ ${escapeHtml(r.year)}` : ""}</small>
            ${r.url ? `<small><a href="${escapeHtml(r.url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(r.url)}</a></small>` : ""}
          </div>
        `).join("");
        fontesBox.style.display = "block";
      }
    } catch (e) {
  console.error(e);
  document.getElementById(loadingId).innerHTML =
    `<strong>IA:</strong> erro ao consultar a API (Worker).<br><small>${escapeHtml(String(e?.message || e))}</small>`;
}


    input.value = "";
  }

  // ====== Init ======
  window.addEventListener("load", () => {
    carregarMensagens();
  });
</script>


</body>
</html>

